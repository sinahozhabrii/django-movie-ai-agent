<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ğŸ¬ Movie AI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --accent: #7c3aed; /* Ø¨Ù†ÙØ´ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ */
        --bg: #ffffff;
        --card: #f8fafc;
        --text: #0f172a;
        --muted: #6b7280;
      }
      /* Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¯Ø§Ø±Ú© Ù…ÙˆØ¯ Ø¨Ø§ Ú©Ù„Ø§Ø³ .dark Ø±ÙˆÛŒ <html> */
      .dark :root,
      .dark {
        --bg: #0b1020;
        --card: #0f1724;
        --text: #e6eef8;
        --muted: #9aa4b2;
      }

      /* Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒØ¯ÛŒÙ… accent Ø±Ùˆ Ø¨Ø§ css var ØªØºÛŒÛŒØ± Ø¨Ø¯ÛŒÙ… */
      .accent {
        background: linear-gradient(
          90deg,
          color-mix(in srgb, var(--accent) 80%, white 20%),
          var(--accent)
        );
        border-color: var(--accent);
      }

      /* Ø§Ø³ØªØ§ÛŒÙ„ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø¨Ø§Øª Ø¨Ø§ var */
      .user-bubble {
        background: var(--accent);
        color: white;
      }
      .bot-bubble {
        background: var(--card);
        color: var(--text);
      }

      /* scrollbar Ù†Ø§Ø²Ú© */
      .chat-scroll::-webkit-scrollbar {
        width: 8px;
      }
      .chat-scroll::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.12);
        border-radius: 8px;
      }
      .chat-scroll {
        -webkit-overflow-scrolling: touch;
      }

      /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¸Ø±ÛŒÙ */
      .fade-in {
        animation: fadeIn 0.22s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }

      /* sidebar transition */
      #sidebar {
        transition: width 0.22s ease, transform 0.22s ease,
          box-shadow 0.22s ease;
      }
      #sidebar.expanded {
        width: 18rem;
      } /* ÙˆÙ‚ØªÛŒ Ø¨Ø§Ø² Ø§Ø³Øª */
      #sidebar.collapsed {
        width: 4.5rem;
      } /* Ø­Ø§Ù„Øª Ø¢ÛŒÚ©ÙˆÙ† ÙÙ‚Ø· */

      /* Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ† Ù…Ù†Ùˆ ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ expanded Ø§Ø³Øª */
      .menu-label {
        opacity: 0;
        transform: translateX(6px);
        transition: all 0.18s ease;
        pointer-events: none;
        white-space: nowrap;
      }
      #sidebar.expanded .menu-label {
        opacity: 1;
        transform: translateX(0);
        pointer-events: auto;
      }

      /* Ù…ÙˆØ¨Ø§ÛŒÙ„: sidebar Ø¨Ù‡ ØµÙˆØ±Øª absolute Ø¨Ø§Ø² Ù…ÛŒØ´Ù‡ Ø±ÙˆÛŒ Ù…Ø­ØªÙˆØ§ */
      @media (max-width: 768px) {
        #sidebar {
          position: fixed;
          left: 0;
          top: 0;
          bottom: 0;
          z-index: 60;
          transform: translateX(-100%);
          box-shadow: 0 6px 30px rgba(2, 6, 23, 0.4);
        }
        #sidebar.open {
          transform: translateX(0);
        }
        #main-overlay {
          display: block;
          position: fixed;
          inset: 0;
          z-index: 50;
          background: rgba(2, 6, 23, 0.35);
        }
      }
    </style>
  </head>
  <body
    class="min-h-screen flex bg-[var(--bg)] text-[var(--text)]"
    id="body-root"
  >
    <!-- Sidebar -->
    <aside
      id="sidebar"
      class="collapsed bg-white dark:bg-[#0b1220] h-full flex flex-col items-stretch shadow-md"
    >
      <div
        class="flex items-center justify-between px-3 py-3 border-b border-gray-100 dark:border-gray-700"
      >
        <div class="flex items-center gap-3">
          <div
            id="brand"
            class="w-10 h-10 rounded-lg flex items-center justify-center"
            style="background: var(--accent)"
          >
            <svg
              class="w-6 h-6 text-white"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
            >
              <path d="M12 2L15 8H9L12 2zM6 10h12v10H6z" />
            </svg>
          </div>
          <div class="menu-label">
            <div class="text-sm font-bold">Movie AI Chat</div>
            <div class="text-xs text-[var(--muted)]">Ú†Øªâ€ŒØ¨Ø§Øª ÙÛŒÙ„Ù…</div>
          </div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± -->
        <button
          id="sidebar-toggle-mobile"
          class="md:hidden p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800"
          aria-label="Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ù†Ùˆ"
        >
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none">
            <path
              stroke="currentColor"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>
      </div>

      <!-- Ù…Ù†ÙˆÙ‡Ø§ -->
      <nav class="flex-1 px-1 py-4 space-y-1">
        <button
          data-action="theme"
          class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-purple-50 dark:hover:bg-purple-900"
        >
          <span class="w-10 flex items-center justify-center text-lg">ğŸŒ—</span>
          <span class="menu-label text-sm">ØªØºÛŒÛŒØ± ØªÙ…</span>
        </button>

        <button
          id="open-customize"
          class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-purple-50 dark:hover:bg-purple-900"
        >
          <span class="w-10 flex items-center justify-center text-lg">ğŸ¨</span>
          <span class="menu-label text-sm">Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø±Ù†Ú¯</span>
        </button>

        <a
          href="#"
          class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-purple-50 dark:hover:bg-purple-900"
        >
          <span class="w-10 flex items-center justify-center text-lg">âš™ï¸</span>
          <span class="menu-label text-sm">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span>
        </a>

        <a
          href="#"
          class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-purple-50 dark:hover:bg-purple-900"
        >
          <span class="w-10 flex items-center justify-center text-lg">ğŸ¤–</span>
          <span class="menu-label text-sm">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¨Ø§Øª</span>
        </a>
      </nav>

      <!-- footer user -->
      <div
        class="px-3 py-3 border-t border-gray-100 dark:border-gray-700 flex items-center gap-3"
      >
        <img
          id="sidebar-avatar"
          src="https://i.pravatar.cc/40"
          alt="avatar"
          class="w-10 h-10 rounded-full border-2"
          style="border-color: var(--accent)"
        />
        <div class="menu-label">
          <div id="sidebar-username" class="text-sm font-semibold">Ú©Ø§Ø±Ø¨Ø±</div>
          <div class="text-xs text-[var(--muted)]">Ø¢Ù†Ù„Ø§ÛŒÙ†</div>
        </div>
      </div>
    </aside>

    <!-- overlay Ù…ÙˆØ¨Ø§ÛŒÙ„ (Ù…ÙˆÙ‚ØªÛŒØŒ ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ sidebar Ø¨Ø§Ø² Ø§Ø³Øª) -->
    <div id="main-overlay" class="hidden md:hidden"></div>

    <!-- Main content -->
    <div id="main" class="flex-1 flex flex-col">
      <!-- header -->
      <header
        class="flex items-center justify-between px-6 py-4 border-b border-gray-100 dark:border-gray-800 bg-[var(--bg)]"
      >
        <div class="flex items-center gap-4">
          <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²/Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± Ø¯Ø± Ø¯Ú©Ø³ØªØ§Ù¾ (Ù‡Ù…Ú†Ù†ÛŒÙ† Ù‡Ø§ÙˆØ± ÙØ¹Ø§Ù„) -->
          <button
            id="sidebar-toggle"
            class="hidden md:inline-flex p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800"
            aria-label="Ø¨Ø§Ø²/Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù†Ùˆ"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none">
              <path
                d="M4 6h16M4 12h16M4 18h16"
                stroke="currentColor"
                stroke-width="2"
              />
            </svg>
          </button>

          <div>
            <h1 class="text-lg font-bold">ğŸ¬ Movie AI Chat</h1>
            <p id="header-username" class="text-xs text-[var(--muted)]">
              Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯
            </p>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <!-- Ù†Ø´Ø§Ù†Ú¯Ø± ØªÙ… Ùˆ Ø¢ÙˆØ§ØªØ§Ø± Ú©Ù†Ø§Ø± Ù‡Ù… -->
          <button
            id="theme-toggle"
            class="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800"
            aria-label="ØªØºÛŒÛŒØ± ØªÙ…"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none">
              <path
                d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"
                stroke="currentColor"
                stroke-width="1.5"
              />
            </svg>
          </button>
          <img
            id="header-avatar"
            src="https://i.pravatar.cc/36"
            alt="avatar"
            class="w-9 h-9 rounded-full border-2"
            style="border-color: var(--accent)"
          />
        </div>
      </header>

      <!-- main chat area -->
      <main class="flex-1 flex flex-col">
        <div id="chat-container" class="flex-1 overflow-hidden flex flex-col">
          <div
            id="chat-box"
            class="flex-1 overflow-y-auto chat-scroll p-6 space-y-4 bg-[var(--card)]"
          >
            <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒØ´Ù† -->
          </div>

          <!-- input area -->
          <form
            id="chat-form"
            class="flex items-center gap-3 p-4 bg-[var(--bg)] border-t border-gray-200 dark:border-gray-800"
          >
            <div class="flex-1">
              <input
                id="user-input"
                dir="auto"
                autocomplete="off"
                class="w-full rounded-full px-4 py-3 bg-white dark:bg-[#071022] border border-gray-200 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-[var(--accent)]"
                placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."
              />
            </div>

            <button
              id="send-btn"
              type="submit"
              class="px-4 py-2 rounded-full text-white"
              style="background: var(--accent)"
            >
              Ø§Ø±Ø³Ø§Ù„
            </button>
          </form>
        </div>
      </main>
    </div>

    <!-- Ù¾Ù†Ù„ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ (Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø¯Ø§Ø®Ù„ ØµÙØ­Ù‡) -->
    <div
      id="customize-panel"
      class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 hidden w-96 bg-[var(--bg)] rounded-xl shadow-2xl border border-gray-100 dark:border-gray-800"
    >
      <div
        class="px-5 py-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between"
      >
        <div>
          <div class="font-bold">Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ</div>
          <div class="text-xs text-[var(--muted)]">
            ØªÙ… Ùˆ Ø±Ù†Ú¯ Ø¢Ú©Ø³Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
          </div>
        </div>
        <button
          id="close-customize"
          class="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800"
        >
          âœ•
        </button>
      </div>

      <div class="p-5 space-y-4">
        <!-- ØªÙ… -->
        <div>
          <div class="text-sm font-medium mb-2">ØªÙ…</div>
          <div class="flex gap-2">
            <button
              data-theme="light"
              class="px-3 py-2 rounded-lg border w-24 text-sm"
            >
              Ø±ÙˆØ´Ù†
            </button>
            <button
              data-theme="dark"
              class="px-3 py-2 rounded-lg border w-24 text-sm"
            >
              ØªØ§Ø±ÛŒÚ©
            </button>
          </div>
        </div>

        <!-- Ø±Ù†Ú¯ Ø¢Ú©Ø³Øª -->
        <div>
          <div class="text-sm font-medium mb-2">Ø±Ù†Ú¯ Ø¢Ú©ÙØ³ÙÙ†Øª</div>
          <div class="flex gap-3 items-center">
            <!-- Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ -->
            <button
              class="accent-swatch w-8 h-8 rounded-full"
              data-color="#7c3aed"
              style="background: #7c3aed; border: 2px solid rgba(0, 0, 0, 0.05)"
            ></button>
            <button
              class="accent-swatch w-8 h-8 rounded-full"
              data-color="#06b6d4"
              style="background: #06b6d4"
            ></button>
            <button
              class="accent-swatch w-8 h-8 rounded-full"
              data-color="#10b981"
              style="background: #10b981"
            ></button>
            <button
              class="accent-swatch w-8 h-8 rounded-full"
              data-color="#f59e0b"
              style="background: #f59e0b"
            ></button>
            <button
              class="accent-swatch w-8 h-8 rounded-full"
              data-color="#ef4444"
              style="background: #ef4444"
            ></button>
            <button
              id="accent-custom"
              class="w-8 h-8 rounded-full flex items-center justify-center border"
              title="Ø±Ù†Ú¯ Ø¯Ù„Ø®ÙˆØ§Ù‡"
            >
              ğŸ¨
            </button>
          </div>
        </div>

        <div class="flex justify-end gap-3">
          <button id="reset-style" class="px-3 py-2 rounded-md border">
            Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ
          </button>
          <button
            id="apply-style"
            class="px-3 py-2 rounded-md text-white"
            style="background: var(--accent)"
          >
            Ø§Ø¹Ù…Ø§Ù„
          </button>
        </div>
      </div>
    </div>

    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ -->
    <script>
      /* ========= Ø¹Ù†Ø§ØµØ± ========= */
      const sidebar = document.getElementById("sidebar");
      const sidebarToggle = document.getElementById("sidebar-toggle");
      const sidebarToggleMobile = document.getElementById(
        "sidebar-toggle-mobile"
      );
      const mainOverlay = document.getElementById("main-overlay");
      const openCustomize = document.getElementById("open-customize");
      const customizePanel = document.getElementById("customize-panel");
      const closeCustomize = document.getElementById("close-customize");
      const chatBox = document.getElementById("chat-box");
      const form = document.getElementById("chat-form");
      const input = document.getElementById("user-input");
      const themeToggle = document.getElementById("theme-toggle");
      const applyStyleBtn = document.getElementById("apply-style");
      const accentSwatches = document.querySelectorAll(".accent-swatch");
      const accentCustom = document.getElementById("accent-custom");
      const resetStyle = document.getElementById("reset-style");

      /* ========= ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ø² localStorage ========= */
      const LS_THEME = "movieai_theme"; // 'light' | 'dark'
      const LS_ACCENT = "movieai_accent"; // hex

      function setAccent(hex) {
        document.documentElement.style.setProperty("--accent", hex);
        // border/avatars etc
        document
          .querySelectorAll("#sidebar-avatar, #header-avatar")
          .forEach((el) => (el.style.borderColor = hex));
        // Ø¯Ú©Ù…Ù‡ Ø§Ø¹Ù…Ø§Ù„ Ø±Ù†Ú¯:
        applyStyleBtn.style.background = hex;
        // Ø°Ø®ÛŒØ±Ù‡
        localStorage.setItem(LS_ACCENT, hex);
      }

      function setTheme(mode) {
        if (mode === "dark") {
          document.documentElement.classList.add("dark");
          localStorage.setItem(LS_THEME, "dark");
        } else {
          document.documentElement.classList.remove("dark");
          localStorage.setItem(LS_THEME, "light");
        }
      }

      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
      (function loadSettings() {
        const savedAccent = localStorage.getItem(LS_ACCENT) || "#7c3aed";
        const savedTheme = localStorage.getItem(LS_THEME) || "light";
        setAccent(savedAccent);
        setTheme(savedTheme);
      })();

      /* ========= Ú©Ù†ØªØ±Ù„ Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± (Ø¯Ø³Ú©ØªØ§Ù¾ Ù‡Ø§ÙˆØ± Ùˆ Ø¯Ú©Ø³ØªØ§Ù¾ Ú©Ù„ÛŒÚ© Ùˆ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¯Ú©Ù…Ù‡) ========= */
      // Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ collapsed
      sidebar.classList.add("collapsed");

      // Ù‡Ø§ÙˆØ± Ø¯Ø³Ú©ØªØ§Ù¾: ÙˆÙ‚ØªÛŒ Ù…Ø§ÙˆØ³ ÙˆØ§Ø±Ø¯ Ø´Ø¯ expand Ø´Ùˆ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡â€ŒÙ†Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ >= md)
      let hoverExpand = false;
      sidebar.addEventListener("mouseenter", () => {
        if (window.matchMedia("(min-width:768px)").matches) {
          sidebar.classList.remove("collapsed");
          sidebar.classList.add("expanded");
          hoverExpand = true;
        }
      });
      sidebar.addEventListener("mouseleave", () => {
        if (hoverExpand) {
          sidebar.classList.remove("expanded");
          sidebar.classList.add("collapsed");
          hoverExpand = false;
        }
      });

      // Ø¯Ú©Ù…Ù‡ Ú©Ù„ÛŒÚ© Ø¯Ø³Ú©ØªØ§Ù¾ (Ø¨Ø±Ø§ÛŒ Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø² Ø¨ÙˆØ¯Ù†)
      let pinned = false;
      sidebarToggle &&
        sidebarToggle.addEventListener("click", () => {
          pinned = !pinned;
          if (pinned) {
            sidebar.classList.remove("collapsed");
            sidebar.classList.add("expanded");
          } else {
            sidebar.classList.remove("expanded");
            sidebar.classList.add("collapsed");
          }
        });

      // Ù…ÙˆØ¨Ø§ÛŒÙ„: Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø¯Ú©Ù…Ù‡ open/close Ú©Ù†ÛŒÙ…
      sidebarToggleMobile &&
        sidebarToggleMobile.addEventListener("click", () => {
          if (sidebar.classList.contains("open")) {
            sidebar.classList.remove("open");
            mainOverlay.classList.add("hidden");
          } else {
            sidebar.classList.add("open");
            mainOverlay.classList.remove("hidden");
          }
        });

      // overlay Ú©Ù„ÛŒÚ© => Ø¨Ø³ØªÙ†
      mainOverlay &&
        mainOverlay.addEventListener("click", () => {
          sidebar.classList.remove("open");
          mainOverlay.classList.add("hidden");
        });

      /* ========= Ù¾Ù†Ù„ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ ========= */
      openCustomize.addEventListener("click", () => {
        customizePanel.classList.remove("hidden");
        customizePanel.classList.add("fade-in");
      });
      closeCustomize.addEventListener("click", () => {
        customizePanel.classList.add("hidden");
      });

      // ØªØºÛŒÛŒØ± ØªÙ… Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ù¾Ù†Ù„
      document.querySelectorAll("[data-theme]").forEach((btn) => {
        btn.addEventListener("click", () =>
          setTheme(btn.getAttribute("data-theme"))
        );
      });

      // Ø³ÙˆØ¦ÛŒÚ† ØªÙ… Ø¹Ù…ÙˆÙ…ÛŒ (Ø§ÛŒÚ©Ù† Ø¨Ø§Ù„Ø§ÛŒ Ù‡Ø¯Ø±)
      themeToggle.addEventListener("click", () => {
        const isDark = document.documentElement.classList.contains("dark");
        setTheme(isDark ? "light" : "dark");
      });

      // Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø§Ø² Ù‚Ø¨Ù„ Ø¢Ù…Ø§Ø¯Ù‡
      accentSwatches.forEach((s) => {
        s.addEventListener("click", () => {
          const hex = s.getAttribute("data-color");
          setAccent(hex);
        });
      });

      // Ø±Ù†Ú¯ Ø¯Ù„Ø®ÙˆØ§Ù‡ (prompt Ø³Ø§Ø¯Ù‡) â€” Ù…ÛŒØªÙˆÙ†ÛŒ Ø§ÛŒÙ† Ø±Ùˆ Ø¨Ø§ color input Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒ
      accentCustom.addEventListener("click", () => {
        const hex = prompt("Ú©Ø¯ Ø±Ù†Ú¯ Ù‡Ú¯Ø² (Ù…Ø«Ø§Ù„: #ff0088) Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
        if (hex && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(hex.trim())) {
          setAccent(hex.trim());
        } else alert("Ú©Ø¯ Ø±Ù†Ú¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª");
      });

      // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ
      resetStyle.addEventListener("click", () => {
        setAccent("#7c3aed");
        setTheme("light");
        localStorage.removeItem(LS_ACCENT);
        localStorage.removeItem(LS_THEME);
      });

      // Ø¯Ú©Ù…Ù‡ Ø§Ø¹Ù…Ø§Ù„ - ÙÙ‚Ø· Ù¾Ù†Ù‡Ø§Ù† Ù†ÛŒØ³Øª Ú†ÙˆÙ† setAccent/setTheme Ù‡Ù…Ø²Ù…Ø§Ù† Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒÚ©Ù†Ù†
      applyStyleBtn.addEventListener("click", () => {
        customizePanel.classList.add("hidden");
      });

      /* ========= Ú†Øª â€” Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¨Ú©â€ŒØ§Ù†Ø¯ ========= */
      function addMessage(text, sender = "user") {
        const wrapper = document.createElement("div");
        wrapper.className =
          "flex items-end gap-3 fade-in " +
          (sender === "user" ? "justify-end" : "justify-start");

        const bubble = document.createElement("div");
        bubble.className = "max-w-[78%] px-4 py-2 rounded-2xl shadow";

        if (sender === "user") {
          bubble.classList.add("user-bubble");
          bubble.style.background = "var(--accent)";
          bubble.style.color = "#fff";
          bubble.style.borderBottomRightRadius = "6px";
        } else {
          bubble.classList.add("bot-bubble");
          bubble.style.background = "var(--card)";
          bubble.style.color = "var(--text)";
          bubble.style.borderBottomLeftRadius = "6px";
        }

        const p = document.createElement("div");
        p.style.whiteSpace = "pre-wrap";
        p.textContent = text; 

        const time = document.createElement("div");
        time.className = "text-[11px] opacity-70 mt-1 text-right";
        time.textContent = new Date().toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });

        bubble.appendChild(p);
        bubble.appendChild(time);

        wrapper.appendChild(bubble);
        chatBox.appendChild(wrapper);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      
      function addTyping() {
        const el = document.createElement("div");
        el.id = "__typing";
        el.className = "flex justify-start fade-in";
        el.innerHTML = `<div class="px-4 py-2 rounded-2xl shadow text-[var(--muted)] bg-[var(--card)]">Ø¯Ø± Ø­Ø§Ù„ Ù†ÙˆØ´ØªÙ†...</div>`;
        chatBox.appendChild(el);
        chatBox.scrollTop = chatBox.scrollHeight;
      }
      function removeTyping() {
        document.getElementById("__typing")?.remove();
      }

      // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = input.value.trim();
        if (!message) return;
        addMessage(message, "user");
        input.value = "";
        addTyping();

        try {
          const response = await fetch("{% url 'chatbot' %}", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
              "X-CSRFToken": "{{ csrf_token }}",
            },
            body: new URLSearchParams({ message }),
          });
          if (!response.ok) throw new Error("network");
          const data = await response.json();
          removeTyping();
          addMessage(data.response || "Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯", "bot");
        } catch (err) {
          removeTyping();
          addMessage("âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±. Ø¨Ø¹Ø¯Ø§ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.", "bot");
        }
      });

      // Ù†Ù…ÙˆÙ†Ù‡ Ù¾ÛŒØ§Ù… Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ (Ø¯Ø± ØµÙˆØ±Øª ØªÙ…Ø§ÛŒÙ„ Ù…ÛŒØªÙˆÙ†ÛŒ Ø­Ø°Ù Ú©Ù†ÛŒ)
      setTimeout(
        () =>
          addMessage(
            "Ø³Ù„Ø§Ù… ğŸ‘‹ Ù…Ù† Movie AI Ù‡Ø³ØªÙ…! Ø¯Ø±Ø¨Ø§Ø±Ù‡ ÙÛŒÙ„Ù…â€ŒÙ‡Ø§ Ø§Ø²Ù… Ø¨Ù¾Ø±Ø³ ğŸ¬",
            "bot"
          ),
        650
      );

      /* ========= Ø±ÙØªØ§Ø± Ù‡Ù†Ú¯Ø§Ù… ØªØºÛŒÛŒØ± Ø§Ù†Ø¯Ø§Ø²Ù‡ ØµÙØ­Ù‡ ========= */
      window.addEventListener("resize", () => {
        if (window.matchMedia("(min-width:768px)").matches) {
          // Ù…Ø·Ù…Ø¦Ù† Ø´Ùˆ overlay Ù…Ø®ÙÛŒ Ø¨Ø§Ø´Ù‡ Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾
          mainOverlay.classList.add("hidden");
          sidebar.classList.remove("open");
        }
      });

      /* ========= Ø¯Ø³ØªØ±Ø³ÛŒ Ú©ÛŒØ¨ÙˆØ±Ø¯: Esc Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ù¾Ù†Ù„â€ŒÙ‡Ø§ ========= */
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          customizePanel.classList.add("hidden");
          sidebar.classList.remove("open");
          mainOverlay.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
